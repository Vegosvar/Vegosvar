<% include ../includes/header %>

<div class="container">
    <section id="main">
        <div class="row">
            <div class="col-md-2">
                <% include template_parts/sidebar %>
            </div>
            <div class="col-md-10">
                <article>
                    <% if('removed' in page && page.removed === true) { %>
                        <h2 class="no-margin-top"><a href="/<%= page.url %>"><%= page.title %></a> är redan borttagen</h2>
                    <% } else { %>
                        <h2 class="no-margin-top">Ta bort sida <a href="/<%= page.url %>"><%= page.title %></a></h2>

                        <div>
                            <button id="reject" class="btn btn-success" data-id="<%= page._id %>">Neka begäran</button>
                            <button id="delete" class="btn btn-danger" data-id="<%= page._id %>">Bekräfta</button>
                        </div>
                        <div style="margin-top:15px">
                            <div id="message" class="alert" style="display:none"></div>
                        </div>
                    <% } %>
                </article>
            </div>
        </div>
    </section>
</div>

<script>
    $(document).ready(function() {
        $('#delete').on('click', function(e) {
            var id = $(e.target).data('id')

            $.ajax({
                url: '/ajax/admin/delete/approve/' + id
            })
            .done(function(result) {
                if(result.success) {
                    $('#message').show().addClass('alert-success').text('Sidan har nu tagits bort')
                } else {
                    $('#message').show().addClass('alert-danger').text('Sidan kunde inte tas bort på grund av ett fel')
                }
            })
        })

        $('#reject').on('click', function(e) {
            var id = $(e.target).data('id')

            $.ajax({
                url: '/ajax/admin/delete/reject/' + id
            })
            .done(function(result) {
                if(result.success) {
                    $('#message').show().addClass('alert-success').text('Borttagningen av sidan har nekats')
                } else {
                    $('#message').show().addClass('alert-danger').text('Borttagningen av sidan kunde inte nekas på grund av ett fel')
                }
            })
        })
    })
</script>

<% include ../includes/footer %>